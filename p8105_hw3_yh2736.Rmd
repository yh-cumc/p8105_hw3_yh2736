---
title: "p8105_hw3_yh"
author: "Yongmei Huang"
date: "10/9/2019"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(p8105.datasets)
data("instacart")
library(lubridate)
library(ggplot2)
```

# Problem 1
```{r, instacart, echo = TRUE}
#check the file size of dataset instacart
object.size(instacart)

#review the variable
str(instacart)

#check the dataset
summary(instacart)

#review the first 10 observations
head(instacart)

```

dataset instacart size is 108695344 byte , about 103.66MB. it including 15 variables, 1384617 observations. variables including order_id, product_id, add_to_cart_order, reordered, user_id, eval_set, order_number, order_dow, order_hour_of_day, days_since_prior_order, product_name, aisle_id, department_id and aisle. 


```{r}
##aisles counters
aisle_dataset <- instacart %>% 
  janitor::clean_names() %>% 
  group_by(aisle) %>% 
  summarize(
    aisle_count = n()
  ) %>% 
  arrange(desc(aisle_count)) %>%           ##according orderd quantity descending arrange the aisle
  select(aisle, aisle_count)               ##select "aisle" and "aisle_count" variable

aisle_dataset                              ##display the counted aisle

```

There are 134 aisles, and the most important top 3 aisles is "fresh vegetables", "fresh fruits" and "packaged vegetables fruits". items ordered from those top3 aisles is 150609, 150473 and 78493 individuely. 

```{r}
##plot aisle which ordered item larger than 10000
aisle_dataset %>% 
  filter(aisle_count > 10000) %>% 
  ggplot(aes(x = reorder(aisle, aisle_count), y = aisle_count)) +
  geom_col() +
  coord_flip() +
  labs(
    title = "Number of productions ordered from each aisles",
    x = "aisle identification",
    y = "order numbers",
    caption = "data from https://www.instacart.com/datasets/grocery-shopping-2017"
  ) +
  theme(
    plot.title = element_text(hjust = 0.5, 
                              size = 15, 
                              face = "bold",
                              color = "blue")
  )

```

```{r}
##setup aisle filter factor
aisle_filter_factor <- c("baking ingredients", 
                         "dog food care", 
                         "packaged vegetables fruits")

##selected three most important items in each aisles
three_import_item_dataset <- instacart %>% 
  group_by(
    aisle, product_name
  ) %>%                                                
  summarize(
    production_order_times = n()
  ) %>% 
  filter(aisle %in% aisle_filter_factor) %>%         ##filter 3 aisles
  arrange(desc(production_order_times)) %>%          ##descending ording based on order times
  group_by(aisle) %>% 
  slice(1:3)                                         ##filter the top3 items

knitr::kable(three_import_item_dataset, 
             align = c(rep('c', time = 3)), 
             caption = "top3 popular production in 3 aisles")    ##using a table to display the output

```

```{r}
##display a table to show the ordered time of two production on each day of the week

##setup the filter factor with "Pink Lady Apples" and "Coffee Ice Cream"
production_filter <- c("Pink Lady Apples", "Coffee Ice Cream")

##based on the production name to calculate the mean order time
mean_order_time <- instacart %>% 
  select(order_dow, order_hour_of_day, product_name) %>% 
  filter(product_name %in% production_filter) %>% 
  group_by(order_dow, product_name) %>% 
  summarize(
    mean_order_hour = round(mean(order_hour_of_day), 
                            digits = 0)
  ) %>% 
  pivot_wider(
    names_from = "product_name",
    values_from = "mean_order_hour"
  ) %>% 
  mutate(
    day_of_week = wday(order_dow + 1, 
                       label = TRUE) 
  ) %>% 
  janitor::clean_names() %>% 
  select(day_of_week, coffee_ice_cream, pink_lady_apples, order_dow) %>% 
  pivot_longer(
    coffee_ice_cream:pink_lady_apples,
    names_to = "production_name",
    values_to = "mean_order_time"
  ) %>% 
  as.tibble()

mean_ordered_dataset <- mean_order_time %>% 
  select(day_of_week, production_name, mean_order_time) %>% 
  pivot_wider(
    names_from = "day_of_week",
    values_from = "mean_order_time"
  )

knitr::kable(mean_ordered_dataset, 
             align = c(rep('c', time = 8)), 
             caption = "mean order time of two production on each day of a week")

```

